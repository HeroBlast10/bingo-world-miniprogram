<!--pages/me/me.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <!-- æœªç™»å½•çŠ¶æ€ - ä¼˜åŒ–åçš„è®¾è®¡ -->
    <view wx:if="{{!hasUserInfo}}" class="login-section">
      <view class="login-header">
        <view class="login-avatar-container">
          <image class="login-avatar" src="{{defaultAvatarUrl}}" mode="aspectFill" />
          <view class="login-avatar-overlay">
            <text class="login-avatar-icon">ğŸ‘‹</text>
          </view>
        </view>
        <view class="login-welcome">
          <text class="login-title">æ¬¢è¿æ¥åˆ°å®¾äº†ä¸ªæœ</text>
          <text class="login-subtitle">å‘ç°æœ‰è¶£çš„å®¾æœä¸–ç•Œ</text>
        </view>
      </view>

      <view class="login-content">
        <view class="login-actions">
          <button class="login-btn primary" bindtap="login" loading="{{isLoading}}">
            <text class="login-btn-icon">ğŸš€</text>
            <text class="login-btn-text">{{isLoading ? 'ç™»å½•ä¸­...' : 'å¾®ä¿¡æˆæƒç™»å½•'}}</text>
          </button>
        </view>
      </view>
    </view>

    <!-- å·²ç™»å½•çŠ¶æ€ -->
    <view wx:else class="logged-in-container">
      <view class="user-row">
        <view class="avatar-wrapper" bindlongpress="onAvatarLongPress">
          <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" binderror="onAvatarError" />
          <button class="avatar-chooser" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar" disabled="{{isChoosingAvatar}}"></button>
          <view class="status-dot"></view>
        </view>
        
        <view class="user-details">
                <view class="name-row">
        <input 
          class="user-name-input" 
          type="nickname" 
          value="{{userInfo.nickName}}" 
          placeholder="å¾®ä¿¡ç”¨æˆ·"
          bind:blur="onNicknameBlur"
          maxlength="20"
        />
      </view>
          <text class="user-description">å®¾æœä¸–ç•Œæ¢ç´¢è€…</text>
        </view>
        
        <view class="logout-wrapper">
          <text class="logout-button" bindtap="logout">é€€å‡º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ® - åªåœ¨å·²ç™»å½•çŠ¶æ€ä¸‹æ˜¾ç¤º -->
  <view wx:if="{{hasUserInfo}}" class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{stats.completed}}</text>
      <text class="stats-label">å·²å®Œæˆ</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.created}}</text>
      <text class="stats-label">å·²åˆ›å»º</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.saved}}</text>
      <text class="stats-label">å·²ä¿å­˜</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{stats.shared}}</text>
      <text class="stats-label">å·²åˆ†äº«</text>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view
      class="menu-item"
      wx:for="{{menuItems}}"
      wx:key="id"
      data-item="{{item}}"
      bindtap="onMenuTap"
    >
      <view class="menu-icon {{item.iconColor}}">
        <text class="menu-icon-text">{{item.icon}}</text>
      </view>
      <text class="menu-title">{{item.title}}</text>
      <view class="menu-arrow">
        <text class="arrow-text">â€º</text>
      </view>
    </view>
  </view>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-section">
    <text class="version-text">å®¾äº†ä¸ªæœ v1.1.6</text>
  </view>
</view>